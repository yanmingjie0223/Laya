window.tbMiniGame=function(e,t){"use strict";class i{static isLocalNativeFile(e){for(var t=0,i=r.nativefiles.length;t<i;t++)if(-1!=e.indexOf(r.nativefiles[t]))return!0;return!1}static isSubNativeFile(e){for(var t=0,i=r.subNativeheads.length;t<i;t++)if(-1!=e.indexOf(r.subNativeheads[t]))return!0;return!1}static isNetFile(e){return(-1!=e.indexOf("http://")||-1!=e.indexOf("https://"))&&-1==e.indexOf(r.window.my.env.USER_DATA_PATH)}static getFileInfo(e){var t=e,n=i.fakeObj[t];return null==n?null:n}static read(e,n="utf8",a=null,s="",o=!1,l=""){var d;d=""==s||-1==s.indexOf("http://")&&-1==s.indexOf("https://")?e:i.getFileNativePath(e),d=t.URL.getAdptedFilePath(d),i.fs.readFile({filePath:d,encoding:n,success:function(e){null!=a&&a.runWith([0,e])},fail:function(e){e&&""!=s?i.downFiles(r.safeEncodeURI(s),n,a,s,o,l):null!=a&&a.runWith([1])}})}static isFile(e){let t;try{t=i.fs.statSync(e)}catch(e){return!1}return t.isFile()}static downFiles(e,t="utf8",n=null,a="",s=!1,o="",l=!0){i.wxdown({url:e,success:function(r){r.hasOwnProperty("statusCode")||(r.statusCode=200),200===r.statusCode?i.readFile(r.apFilePath,t,n,a,s,o,l):403===r.statusCode?null!=n&&n.runWith([0,e]):null!=n&&n.runWith([1,r])},fail:function(e){console.log("downloadfile fail:",a,e),null!=n&&n.runWith([1,e])}}).onProgressUpdate((function(e){null!=n&&n.runWith([2,e.progress])}))}static readFile(e,n="utf8",a=null,s="",o=!1,l="",d=!0){e=t.URL.getAdptedFilePath(e),i.fs.readFile({filePath:e,encoding:n,success:function(t){!e.indexOf(r.window.my.env.USER_DATA_PATH)||-1==e.indexOf("http://")&&-1==e.indexOf("https://")?null!=a&&a.runWith([0,t]):o?(null!=a&&a.runWith([0,t]),i.copyTOCache(e,s,null,n,d)):null!=a&&a.runWith([0,t])},fail:function(e){e&&null!=a&&a.runWith([1,e])}})}static downOtherFiles(e,t=null,n="",a=!1,s=!0){i.wxdown({url:e,success:function(e){e.hasOwnProperty("statusCode")||(e.statusCode=200),200===e.statusCode?a&&-1==n.indexOf(".php")?(null!=t&&t.runWith([0,e.apFilePath]),i.copyTOCache(e.apFilePath,n,null,"",s)):null!=t&&t.runWith([0,e.apFilePath]):null!=t&&t.runWith([1,e])},fail:function(e){console.log("downloadfile fail:",n,e),null!=t&&t.runWith([1,e])}})}static copyFile(e,t,n=null){i.fs.copyFile({srcPath:e,destPath:t,success:function(){n&&n.runWith(0)},fail:function(e){n&&n.runWith([1,e])}})}static downLoadFile(e,n="",a=null,s="utf8",o=!1){window.navigator.userAgent.indexOf("AlipayMiniGame")<0?t.Laya.loader.load(e,a):n==t.Loader.IMAGE||n==t.Loader.SOUND?i.downOtherFiles(r.safeEncodeURI(e),a,e,o,!1):i.downFiles(r.safeEncodeURI(e),s,a,e,!0,n,o)}static copyTOCache(e,n,a,s="",o=!0){var l=e.split("/"),d=l[l.length-1],u=n,c=i.getFileInfo(n),h=i.getFileNativePath(d);i.fakeObj[u]={md5:d,readyUrl:n,size:0,times:t.Browser.now(),encoding:s,tempFilePath:e};var f=r.sizeLimit,p=i.getCacheUseSize();c?c.readyUrl!=n?i.fs.getFileInfo({filePath:e,success:function(t){o&&p+4194304+t.size>=f&&(t.size>r.minClearSize&&(r.minClearSize=t.size),i.onClearCacheRes()),i.deleteFile(e,n,a,s,t.size)},fail:function(e){null!=a&&a.runWith([1,e])}}):null!=a&&a.runWith([0]):i.fs.getFileInfo({filePath:e,success:function(t){o&&p+4194304+t.size>=f&&(t.size>r.minClearSize&&(r.minClearSize=t.size),i.onClearCacheRes()),i.fs.copyFile({srcPath:e,destPath:h,success:function(e){i.onSaveFile(n,d,!0,s,a,t.size)},fail:function(e){null!=a&&a.runWith([1,e])}})},fail:function(e){null!=a&&a.runWith([1,e])}})}static onClearCacheRes(){var e=r.minClearSize,t=[];for(var n in i.filesListObj)"fileUsedSize"!=n&&t.push(i.filesListObj[n]);i.sortOn(t,"times",i.NUMERIC);for(var a=0,s=1,o=t.length;s<o;s++){var l=t[s];if(a>=e)break;a+=l.size,i.deleteFile("",l.readyUrl)}}static sortOn(e,t,n=0){return n==i.NUMERIC?e.sort((function(e,i){return e[t]-i[t]})):n==(i.NUMERIC|i.DESCENDING)?e.sort((function(e,i){return i[t]-e[t]})):e.sort((function(e,i){return e[t]-i[t]}))}static getFileNativePath(e){return i.fileNativeDir+"/"+e}static deleteFile(e,t="",n=null,a="",s=0){var o=i.getFileInfo(t),l=i.getFileNativePath(o.md5);i.fs.unlink({filePath:l,success:function(o){if(""!=e){var l=i.getFileNativePath(e);i.fs.copyFile({srcPath:e,destPath:l,success:function(o){i.onSaveFile(t,e,!0,a,n,s)},fail:function(e){null!=n&&n.runWith([1,e])}})}else i.onSaveFile(t,e,!1,a,n,s)},fail:function(e){null!=n&&n.runWith([1,e])}})}static deleteAll(){var e=[];for(var t in i.filesListObj)"fileUsedSize"!=t&&e.push(i.filesListObj[t]);for(var n=1,a=e.length;n<a;n++){var s=e[n];i.deleteFile("",s.readyUrl)}i.filesListObj&&i.filesListObj.fileUsedSize&&(i.filesListObj.fileUsedSize=0),i.writeFilesList("",JSON.stringify({}),!1)}static onSaveFile(e,n,a=!0,s="",o=null,l=0){var r=e;if(null==i.filesListObj.fileUsedSize&&(i.filesListObj.fileUsedSize=0),a){var d=i.getFileNativePath(n);i.filesListObj[r]={md5:n,readyUrl:e,size:l,times:t.Browser.now(),encoding:s,tempFilePath:d},i.filesListObj.fileUsedSize=parseInt(i.filesListObj.fileUsedSize)+l,i.writeFilesList(r,JSON.stringify(i.filesListObj),!0),null!=o&&o.runWith([0])}else if(i.filesListObj[r]){var u=parseInt(i.filesListObj[r].size);i.filesListObj.fileUsedSize=parseInt(i.filesListObj.fileUsedSize)-u,i.fakeObj[r].md5==i.filesListObj[r].md5&&delete i.fakeObj[r],delete i.filesListObj[r],i.writeFilesList(r,JSON.stringify(i.filesListObj),!1),null!=o&&o.runWith([0])}}static writeFilesList(e,t,n){var a=i.fileNativeDir+"/"+i.fileListName;i.fs.writeFile({filePath:a,encoding:"utf8",data:t,success:function(e){},fail:function(e){}}),!r.isZiYu&&r.isPosMsgYu&&r.window.my.postMessage&&r.window.my.postMessage({url:e,data:i.filesListObj[e],isLoad:"filenative",isAdd:n})}static getCacheUseSize(){return i.filesListObj&&i.filesListObj.fileUsedSize?i.filesListObj.fileUsedSize:0}static getCacheList(e,t){let n;try{n=i.fs.statSync(e)}catch(e){n=null}n?i.readSync(i.fileListName,"utf8",t):(i.fs.mkdirSync(e,!0),t&&t.runWith([1]))}static existDir(e,t){i.fs.mkdir({dirPath:e,success:function(e){null!=t&&t.runWith([0,{data:JSON.stringify({})}])},fail:function(e){10025==e.error?i.readSync(i.fileListName,"utf8",t):null!=t&&t.runWith([1,e])}})}static readSync(e,t="utf8",n=null,a=""){var s,o=i.getFileNativePath(e);try{i.fs.readFile({filePath:o,encoding:t,success:function(e){s=e.data,null!=n&&n.runWith([0,{data:s}])},fail:function(){null!=n&&n.runWith([1])}})}catch(e){null!=n&&n.runWith([1])}}static setNativeFileDir(e){i.fileNativeDir=r.window.my.env.USER_DATA_PATH+e}}i.fs=window.my.getFileSystemManager(),i.wxdown=window.my.downloadFile,i.filesListObj={},i.fakeObj={},i.fileListName="layaairfiles.txt",i.ziyuFileData={},i.ziyuFileTextureData={},i.loadPath="",i.DESCENDING=2,i.NUMERIC=16;class n extends t.SoundChannel{constructor(e){super(),this._sound=e,this._audio=e._sound,this._onCanplay=this.onCanPlay.bind(this),this._onError=this.onError.bind(this),this._onEnd=this.__onEnd.bind(this),this.addEventListener()}addEventListener(){this._audio.onError(this._onError),this._audio.onCanplay(this._onCanplay)}offEventListener(){this._audio.offError(this._onError),this._audio.offCanplay(this._onCanplay),this._audio.offEnded(this._onEnd)}onError(e){console.log("-----1---------------minisound-----url:",this.url),console.log(e),this.event(t.Event.ERROR),this._audio&&(this._sound.dispose(),this.offEventListener(),this._sound=this._audio=null)}onCanPlay(){this._audio&&(this.event(t.Event.COMPLETE),this.offEventListener(),this._audio.onEnded(this._onEnd),this.isStopped?this.stop():this.play())}__onEnd(){if(1==this.loops)return this.completeHandler&&(t.Laya.systemTimer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event(t.Event.COMPLETE);this.loops>0&&this.loops--,this.startTime=0,this.play()}play(){this.isStopped=!1,t.SoundManager.addChannel(this),this._audio&&this._audio.play()}set startTime(e){this._audio&&(this._audio.startTime=e)}set autoplay(e){this._audio&&(this._audio.autoplay=e)}get autoplay(){return!!this._audio&&this._audio.autoplay}get position(){return this._audio?this._audio.currentTime:0}get duration(){return this._audio?this._audio.duration:0}stop(){super.stop(),this.isStopped=!0,t.SoundManager.removeChannel(this),this.completeHandler=null,this._audio&&(this._audio.stop(),this.loop||(this.offEventListener(),this._sound.dispose(),this._sound=null,this._audio=null))}pause(){this.isStopped=!0,this._audio&&this._audio.pause()}get loop(){return!!this._audio&&this._audio.loop}set loop(e){this._audio&&(this._audio.loop=e)}resume(){this.isStopped=!1,t.SoundManager.addChannel(this),this._audio&&this._audio.play()}set volume(e){this._audio&&(this._audio.volume=e)}get volume(){return this._audio?this._audio.volume:0}}class a extends t.EventDispatcher{constructor(){super(),this.loaded=!1,this._sound=a._createSound()}static __init__(){for(let e=0;e<10;e++){let e=r.window.my.createInnerAudioContext();a.cachePool.push(e)}}static _createSound(){return a.cachePool.length?a.cachePool.pop():r.window.my.createInnerAudioContext()}load(e){if(i.isLocalNativeFile(e)){if(-1==e.indexOf(r.window.my.env.USER_DATA_PATH)&&(-1!=e.indexOf("http://")||-1!=e.indexOf("https://")))if(""!=i.loadPath)e=e.split(i.loadPath)[1];else{var n=""!=t.URL.rootPath?t.URL.rootPath:t.URL._basePath;""!=n&&(e=e.split(n)[1])}}else e=t.URL.formatURL(e);if(this.url=e,this.readyUrl=e,r.autoCacheFile&&i.getFileInfo(e))this.onDownLoadCallBack(e,0);else if(r.autoCacheFile)if(i.isLocalNativeFile(e)){if(r.subNativeFiles&&0==r.subNativeheads.length)for(var a in r.subNativeFiles){var s=r.subNativeFiles[a];r.subNativeheads=r.subNativeheads.concat(s);for(let e=0;e<s.length;e++)r.subMaps[s[e]]=a+"/"+s[e]}if(r.subNativeFiles&&-1!=e.indexOf("/")){var o=e.split("/")[0]+"/";if(o&&-1!=r.subNativeheads.indexOf(o)){var l=r.subMaps[o];e=e.replace(o,l)}}this.onDownLoadCallBack(e,0)}else-1==e.indexOf("http://")&&-1==e.indexOf("https://")||-1!=e.indexOf(r.window.my.env.USER_DATA_PATH)?this.onDownLoadCallBack(e,0):i.downOtherFiles(e,t.Handler.create(this,this.onDownLoadCallBack,[e]),e,r.autoCacheFile);else this.onDownLoadCallBack(e,0)}onDownLoadCallBack(e,n,a=null){var s;if(!n&&this._sound)if(r.autoCacheFile){if(a)s=a;else if(i.isLocalNativeFile(e)){var o=""!=t.URL.rootPath?t.URL.rootPath:t.URL._basePath,l=e;""==o||-1==e.indexOf("http://")&&-1==e.indexOf("https://")||(s=e.split(o)[1]),s||(s=l),s=i.isSubNativeFile(s)?s:r.baseDir+s}else{var d=i.getFileInfo(e);if(d&&d.md5){var u=d.md5;s=i.getFileNativePath(u)}else s=-1==e.indexOf("http://")&&-1==e.indexOf("https://")&&-1==e.indexOf(r.window.my.env.USER_DATA_PATH)?r.baseDir+e:e}this._sound.src=this.readyUrl=s}else(i.isLocalNativeFile(e)||-1==e.indexOf("http://")&&-1==e.indexOf("https://")&&-1==e.indexOf(r.window.my.env.USER_DATA_PATH)&&!i.isSubNativeFile(s))&&(e=r.baseDir+e),this._sound.src=this.readyUrl=e;else this.event(t.Event.ERROR)}play(e=0,i=0){if(!this.url)return null;var a=new n(this);return a.url=this.url,a.loops=i,a.loop=0===i,a.startTime=e,a.isStopped=!1,t.SoundManager.addChannel(a),a}get duration(){return this._sound.duration}dispose(){this._sound&&(a.cachePool.push(this._sound),this._sound=null,this.readyUrl=this.url=null)}}a.cachePool=[];class s{constructor(){}static _createInputElement(){t.Input._initInput(t.Input.area=t.Browser.createElement("textarea")),t.Input._initInput(t.Input.input=t.Browser.createElement("input")),t.Input.inputContainer=t.Browser.createElement("div"),t.Input.inputContainer.style.position="absolute",t.Input.inputContainer.style.zIndex=1e5,t.Browser.container.appendChild(t.Input.inputContainer),t.SoundManager._soundClass=a,t.SoundManager._musicClass=a;var e=r.systemInfo.model,i=r.systemInfo.system;-1!=e.indexOf("iPhone")&&(t.Browser.onIPhone=!0,t.Browser.onIOS=!0,t.Browser.onIPad=!0,t.Browser.onAndroid=!1),-1==i.indexOf("Android")&&-1==i.indexOf("Adr")||(t.Browser.onAndroid=!0,t.Browser.onIPhone=!1,t.Browser.onIOS=!1,t.Browser.onIPad=!1)}static _onStageResize(){t.Laya.stage._canvasTransform.identity().scale(t.Browser.width/t.Render.canvas.width/t.Browser.pixelRatio,t.Browser.height/t.Render.canvas.height/t.Browser.pixelRatio)}static wxinputFocus(e){}static inputEnter(){t.Input.inputElement.target.focus=!1}static wxinputblur(){s.hideKeyboard()}static hideKeyboard(){}}class o extends t.EventDispatcher{constructor(){super()}_loadResourceFilter(e,n){if(this.sourceUrl=t.URL.formatURL(n),i.isNetFile(n))if(""!=i.loadPath)n=n.split(i.loadPath)[1];else{var a=""!=t.URL.rootPath?t.URL.rootPath:t.URL._basePath,s=n;""!=a&&(n=n.split(a)[1]),n||(n=s)}if(r.subNativeFiles&&0==r.subNativeheads.length)for(var l in r.subNativeFiles){var d=r.subNativeFiles[l];r.subNativeheads=r.subNativeheads.concat(d);for(var u=0;u<d.length;u++)r.subMaps[d[u]]=l+"/"+d[u]}if(r.subNativeFiles&&-1!=n.indexOf("/")){var c=n.split("/")[0]+"/";if(c&&-1!=r.subNativeheads.indexOf(c)){var h=r.subMaps[c];n=n.replace(c,h)}}switch(e){case t.Loader.IMAGE:case"htmlimage":case"nativeimage":o._transformImgUrl(n,e,this);break;case t.Loader.SOUND:this._loadSound(n);break;default:this._loadResource(e,n)}}_loadSound(e){if(r.autoCacheFile){var n=t.URL.formatURL(e);i.getFileInfo(n)?o.onDownLoadCallBack(e,this,0):i.isLocalNativeFile(e)?-1!=n.indexOf(r.window.my.env.USER_DATA_PATH)||i.isSubNativeFile(e)?o.onDownLoadCallBack(e,this,0):o.onDownLoadCallBack(r.baseDir+e,this,0):i.isNetFile(n)?i.downOtherFiles(r.safeEncodeURI(n),t.Handler.create(o,o.onDownLoadCallBack,[n,this]),n,r.autoCacheFile):o.onDownLoadCallBack(r.baseDir+e,this,0)}else o.onDownLoadCallBack(e,this,0)}static onDownLoadCallBack(e,n,a,s=null){if(a)n.event(t.Event.ERROR,"Load sound failed");else{var o;if(r.autoCacheFile)if(s)o=s;else if(i.isLocalNativeFile(e))o=e;else{var l=i.getFileInfo(e);o=l&&l.md5?l.tempFilePath||i.getFileNativePath(l.md5):e}else o=t.URL.formatURL(e);e=o;var d=new t.SoundManager._soundClass;d.load(r.safeEncodeURI(e)),n.onLoaded(d)}}static bindToThis(e,t){return e.bind(t)}complete(e){e instanceof t.Resource?e._setCreateURL(this.sourceUrl):e instanceof t.Texture&&e.bitmap instanceof t.Resource&&e.bitmap._setCreateURL(this.sourceUrl),this.originComplete(e)}_loadHttpRequestWhat(e,n){var a=r.getUrlEncode(e,n);if(t.Loader.preLoadedMap[e])this.onLoaded(t.Loader.preLoadedMap[e]);else{var s=t.URL.formatURL(e),l=i.getFileInfo(s);if(l){l.encoding=null==l.encoding?"utf8":l.encoding;var d=l.tempFilePath||i.getFileNativePath(l.md5);i.readFile(d,a,new t.Handler(o,o.onReadNativeCallBack,[e,n,this]),e)}else-1==s.indexOf("http://")&&-1==s.indexOf("https://")||i.isLocalNativeFile(e)?-1!=s.indexOf(r.window.my.env.USER_DATA_PATH)||i.isSubNativeFile(e)?i.readFile(e,a,new t.Handler(o,o.onReadNativeCallBack,[e,n,this]),e):i.readFile(r.baseDir+e,a,new t.Handler(o,o.onReadNativeCallBack,[e,n,this]),e):i.downFiles(r.safeEncodeURI(s),a,new t.Handler(o,o.onReadNativeCallBack,[e,n,this]),s,r.AutoCacheDownFile)}}static onReadNativeCallBack(e,i=null,n=null,a=0,s=null){if(a)1==a&&n.onError&&n.onError(s);else try{var o;o=i==t.Loader.JSON||i==t.Loader.ATLAS||i==t.Loader.PREFAB||i==t.Loader.PLF?r.getJson(s.data):i==t.Loader.XML?t.Utils.parseXMLFromString(s.data):s.data,n.onLoaded(o)}catch(e){n.onError&&n.onError(s)}}static _transformImgUrl(e,n,a){let s=t.URL.formatURL(e);i.isLocalNativeFile(e)||-1==s.indexOf("http://")&&-1==s.indexOf("https://")?-1==s.indexOf(r.window.my.env.USER_DATA_PATH)?o.onCreateImage(e,a,!0):o.onCreateImage(e,a,!1,e):o.onCreateImage(e,a,!1,s)}static onCreateImage(e,t,n=!1,a=""){var s;s=n?i.isSubNativeFile(e)?e:r.baseDir+e:""!=a?a:e,t._loadImage(r.safeEncodeURI(s),!1)}}class l{constructor(){}static __init__(){l.items=l}static setItem(e,t){r.window.my.setStorageSync({key:e,data:t})}static getItem(e){return r.window.my.getStorageSync({key:e}).data}static setJSON(e,t){try{l.setItem(e,JSON.stringify(t))}catch(e){console.warn("set localStorage failed",e)}}static getJSON(e){return JSON.parse(l.getItem(e))}static removeItem(e){r.window.my.removeStorageSync({key:e})}static clear(){r.window.my.clearStorageSync()}static getStorageInfoSync(){try{var e=r.window.my.getStorageInfoSync();return console.log(e.keys),console.log(e.currentSize),console.log(e.limitSize),e}catch(e){}return null}}l.support=!0;class r{static getJson(e){return JSON.parse(e)}static enable(){r.init(t.Laya.isWXPosMsg,t.Laya.isWXOpenDataContext)}static init(e=!1,n=!1){r._inited||(r._inited=!0,r.window=window,r.window.hasOwnProperty("my")&&(r.isZiYu=n,r.isPosMsgYu=e,r.EnvConfig={},r.isZiYu||(i.setNativeFileDir("/layaairGame"),i.getCacheList(i.fileNativeDir,t.Handler.create(r,r.onMkdirCallBack))),r.systemInfo=r.window.my.getSystemInfoSync(),r.window.focus=function(){},t.Laya._getUrlPath=function(){return""},r.window.logtime=function(e){},r.window.alertTimeLog=function(e){},r.window.resetShareInfo=function(){},r.window.CanvasRenderingContext2D=function(){},t.HttpRequest._urlEncode=r.safeEncodeURI,r._preCreateElement=t.Browser.createElement,r.window.CanvasRenderingContext2D.prototype=r._preCreateElement("canvas").getContext("2d").__proto__,r.window.document.body.appendChild=function(){},t.Browser.createElement=r.createElement,t.RunDriver.createShaderCondition=r.createShaderCondition,t.Utils.parseXMLFromString=r.parseXMLFromString,t.Input._createInputElement=s._createInputElement,t.Loader.prototype._loadResourceFilter=o.prototype._loadResourceFilter,t.Loader.prototype._loadSound=o.prototype._loadSound,t.Loader.prototype.originComplete=t.Loader.prototype.complete,t.Loader.prototype.complete=o.prototype.complete,t.Loader.prototype._loadHttpRequestWhat=o.prototype._loadHttpRequestWhat,t.Config.useRetinalCanvas=!0,t.LocalStorage._baseClass=l,l.__init__(),a.__init__(),r.window.my.onMessage&&r.window.my.onMessage(r._onMessage)))}static _onMessage(e){switch(e.type){case"changeMatrix":t.Laya.stage.transform.identity(),t.Laya.stage._width=e.w,t.Laya.stage._height=e.h,t.Laya.stage._canvasTransform=new t.Matrix(e.a,e.b,e.c,e.d,e.tx,e.ty);break;case"display":t.Laya.stage.frameRate=e.rate||t.Stage.FRAME_FAST;break;case"undisplay":t.Laya.stage.frameRate=t.Stage.FRAME_SLEEP}"opendatacontext"==e.isLoad?e.url&&(i.ziyuFileData[e.url]=e.atlasdata,i.ziyuFileTextureData[e.imgReadyUrl]=e.imgNativeUrl):"openJsondatacontext"==e.isLoad?e.url&&(i.ziyuFileData[e.url]=e.atlasdata):"openJsondatacontextPic"==e.isLoad&&(i.ziyuFileTextureData[e.imgReadyUrl]=e.imgNativeUrl)}static getUrlEncode(e,t){return"arraybuffer"==t?"":"utf8"}static downLoadFile(e,t="",n=null,a="utf8"){i.getFileInfo(e)?null!=n&&n.runWith([0]):i.downLoadFile(r.safeEncodeURI(e),t,n,a)}static remove(e,t=null){i.deleteFile("",e,t,"",0)}static removeAll(){i.deleteAll()}static hasNativeFile(e){return i.isLocalNativeFile(e)}static getFileInfo(e){return i.getFileInfo(e)}static getFileList(){return i.filesListObj}static exitMiniProgram(){r.window.my.exitMiniProgram()}static onMkdirCallBack(e,t){e?(i.fakeObj={},i.filesListObj={}):(i.filesListObj=JSON.parse(t.data),i.fakeObj=JSON.parse(t.data)||{});let n=i.fs.readdirSync(i.fileNativeDir);if(n&&n.length){var a,s,o={};for(let e in i.filesListObj)"fileUsedSize"!=e&&(o[(a=i.filesListObj[e]).md5]=a.readyUrl);for(let e=0,t=n.length;e<t;e++)if((s=n[e])!=i.fileListName){if(!o[s]){let e=i.getFileNativePath(s);i.fs.unlink({filePath:e,success:function(e){console.log("删除无引用的磁盘文件:"+s)}})}delete o[s]}for(let e in o)delete i.filesListObj[o[e]],delete i.fakeObj[o[e]],console.log("删除错误记录：",o[e])}}static pixelRatio(){if(!r.EnvConfig.pixelRatioInt)try{return r.EnvConfig.pixelRatioInt=r.systemInfo.pixelRatio,r.systemInfo.pixelRatio}catch(e){}return r.EnvConfig.pixelRatioInt}static createElement(e){if("canvas"==e){var t;if(1==r.idx){if(t=r.window.canvas.getRealCanvas(),!my.isIDE){var i=t.getContext;t.getContext=function(e){var n=i.apply(t,[e]);return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n}}}else t=r._preCreateElement(e);return!t.style&&(t.style={}),r.idx++,t}if("textarea"==e||"input"==e)return r.onCreateInput(e);if("div"==e){var n=r._preCreateElement(e);return n.contains=function(e){return null},n.removeChild=function(e){},n}return r._preCreateElement(e)}static onCreateInput(e){var t=r._preCreateElement(e);return t.focus=s.wxinputFocus,t.blur=s.wxinputblur,t.value=0,t.placeholder={},t.type={},t.setColor=function(e){},t.setType=function(e){},t.setFontFace=function(e){},t.contains=function(e){return null},t}static createShaderCondition(e){return function(){return this[e.replace("this.","")]}}}r.IGNORE=new RegExp("[-_.!~*'();/?:@&=+$,#%]|[0-9|A-Z|a-z]"),r.safeEncodeURI=function(e){for(var t="",i=e.length,n=0;n<i;n++){var a=e[n];if(r.IGNORE.test(a))t+=a;else try{t+=encodeURI(a)}catch(e){console.log("errorInfo",">>>"+a)}}return t},r._inited=!1,r.autoCacheFile=!0,r.minClearSize=5242880,r.sizeLimit=52428800,r.nativefiles=["layaNativeDir"],r.subNativeFiles=[],r.subNativeheads=[],r.subMaps=[],r.AutoCacheDownFile=!1,r.baseDir="pages/index/",r.parseXMLFromString=function(e){var t;e=e.replace(/>\s+</g,"><");try{t=(new r.window.Parser.DOMParser).parseFromString(e,"text/xml")}catch(e){throw"需要引入xml解析库文件"}return t},r.idx=1;class d extends t.EventDispatcher{constructor(){super()}static __init__(){try{var e;if(!(e=t.Accelerator))return;e.prototype.on=d.prototype.on,e.prototype.off=d.prototype.off}catch(e){}}static startListen(e){if(d._callBack=e,!d._isListening){d._isListening=!0;try{r.window.my.onAccelerometerChange(d.onAccelerometerChange)}catch(e){}}}static stopListen(){d._isListening=!1;try{r.window.my.stopAccelerometer({})}catch(e){}}static onAccelerometerChange(e){var t;(t={}).acceleration=e,t.accelerationIncludingGravity=e,t.rotationRate={},null!=d._callBack&&d._callBack(t)}on(e,t,i,n=null){return super.on(e,t,i,n),d.startListen(this.onDeviceOrientationChange),this}off(e,t,i,n=!1){return this.hasListener(e)||d.stopListen(),super.off(e,t,i,n)}}d._isListening=!1;class u{constructor(){}static __init__(){r.window.navigator.geolocation.getCurrentPosition=u.getCurrentPosition,r.window.navigator.geolocation.watchPosition=u.watchPosition,r.window.navigator.geolocation.clearWatch=u.clearWatch}static getCurrentPosition(e=null,t=null,i=null){var n;(n={}).success=function(t){null!=e&&e(t)},n.fail=t,r.window.my.getLocation(n)}static watchPosition(e=null,i=null,n=null){var a;return u._curID++,(a={}).success=e,a.error=i,u._watchDic[u._curID]=a,t.Laya.systemTimer.loop(1e3,null,u._myLoop),u._curID}static clearWatch(e){delete u._watchDic[e],u._hasWatch()||t.Laya.systemTimer.clear(null,u._myLoop)}static _hasWatch(){var e;for(e in u._watchDic)if(u._watchDic[e])return!0;return!1}static _myLoop(){u.getCurrentPosition(u._mySuccess,u._myError)}static _mySuccess(e){var i,n={};for(i in n.coords=e,n.timestamp=t.Browser.now(),u._watchDic)u._watchDic[i].success&&u._watchDic[i].success(n)}static _myError(e){var t;for(t in u._watchDic)u._watchDic[t].error&&u._watchDic[t].error(e)}}u._watchDic={},u._curID=0;e.MiniAccelerator=d,e.MiniFileMgr=i,e.MiniInput=s,e.MiniLoader=o,e.MiniLocalStorage=l,e.MiniLocation=u,e.MiniSound=a,e.MiniSoundChannel=n,e.MiniVideo=class{constructor(e=320,t=240){this.videoend=!1,this.videourl="",this.videoElement=r.window.my.createVideo({width:e,height:t,autoplay:!0})}static __init__(){}on(e,t,i){"loadedmetadata"==e?(this.onPlayFunc=i.bind(t),this.videoElement.onPlay=this.onPlayFunction.bind(this)):"ended"==e&&(this.onEndedFunC=i.bind(t),this.videoElement.onEnded=this.onEndedFunction.bind(this)),this.videoElement.onTimeUpdate=this.onTimeUpdateFunc.bind(this)}onTimeUpdateFunc(e){this.position=e.position,this._duration=e.duration}get duration(){return this._duration}onPlayFunction(){this.videoElement&&(this.videoElement.readyState=200),console.log("=====视频加载完成========"),null!=this.onPlayFunc&&this.onPlayFunc()}onEndedFunction(){this.videoElement&&(this.videoend=!0,console.log("=====视频播放完毕========"),null!=this.onEndedFunC&&this.onEndedFunC())}off(e,t,i){"loadedmetadata"==e?(this.onPlayFunc=i.bind(t),this.videoElement.offPlay=this.onPlayFunction.bind(this)):"ended"==e&&(this.onEndedFunC=i.bind(t),this.videoElement.offEnded=this.onEndedFunction.bind(this))}load(e){this.videoElement&&(this.videoElement.src=e)}play(){this.videoElement&&(this.videoend=!1,this.videoElement.play())}pause(){this.videoElement&&(this.videoend=!0,this.videoElement.pause())}get currentTime(){return this.videoElement?this.videoElement.initialTime:0}set currentTime(e){this.videoElement&&(this.videoElement.initialTime=e)}get videoWidth(){return this.videoElement?this.videoElement.width:0}get videoHeight(){return this.videoElement?this.videoElement.height:0}get ended(){return this.videoend}get loop(){return!!this.videoElement&&this.videoElement.loop}set loop(e){this.videoElement&&(this.videoElement.loop=e)}get playbackRate(){return this.videoElement?this.videoElement.playbackRate:0}set playbackRate(e){this.videoElement&&(this.videoElement.playbackRate=e)}get muted(){return!!this.videoElement&&this.videoElement.muted}set muted(e){this.videoElement&&(this.videoElement.muted=e)}get paused(){return!!this.videoElement&&this.videoElement.paused}size(e,t){this.videoElement&&(this.videoElement.width=e,this.videoElement.height=t)}get x(){return this.videoElement?this.videoElement.x:0}set x(e){this.videoElement&&(this.videoElement.x=e)}get y(){return this.videoElement?this.videoElement.y:0}set y(e){this.videoElement&&(this.videoElement.y=e)}get currentSrc(){return this.videoElement.src}destroy(){this.videoElement&&this.videoElement.destroy(),this.videoElement=null,this.onEndedFunC=null,this.onPlayFunc=null,this.videoend=!1,this.videourl=null}reload(){this.videoElement&&(this.videoElement.src=this.videourl)}},e.TBMiniAdapter=r};