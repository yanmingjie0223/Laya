!function(n,i,e){e.un,e.uns;var t=e.static,a=e.class,o=e.getset,r=(e.__newvec,laya.utils.Browser),l=(laya.events.Event,laya.events.EventDispatcher),u=laya.resource.HTMLImage,s=laya.utils.Handler,d=laya.display.Input,c=laya.net.Loader,f=(laya.maths.Matrix,laya.renders.Render),p=laya.utils.RunDriver,h=(laya.media.Sound,laya.media.SoundChannel),v=laya.media.SoundManager,m=(laya.display.Stage,laya.net.URL),g=laya.utils.Utils,y=function(){function i(){}return a(i,"laya.wx.mini.MiniAdpter"),i.getJson=function(n){return JSON.parse(n)},i.init=function(t,a){void 0===t&&(t=!1),void 0===a&&(a=!1),i._inited||(i.window=n,i.window.navigator.userAgent.indexOf("MiniGame")<0||(i._inited=!0,i.isZiYu=a,i.isPosMsgYu=t,i.EnvConfig={},i.isZiYu||(C.setNativeFileDir("/layaairGame"),C.existDir(C.fileNativeDir,s.create(i,i.onMkdirCallBack))),i.window.focus=function(){},e.getUrlPath=function(){},i.window.logtime=function(n){},i.window.alertTimeLog=function(n){},i.window.resetShareInfo=function(){},i.window.CanvasRenderingContext2D=function(){},i.window.CanvasRenderingContext2D.prototype=i.window.wx.createCanvas().getContext("2d").__proto__,i.window.document.body.appendChild=function(){},i.EnvConfig.pixelRatioInt=0,p.getPixelRatio=i.pixelRatio,i._preCreateElement=r.createElement,r.createElement=i.createElement,p.createShaderCondition=i.createShaderCondition,g.parseXMLFromString=i.parseXMLFromString,d._createInputElement=_._createInputElement,i.EnvConfig.load=c.prototype.load,c.prototype.load=x.prototype.load,c.prototype._loadImage=w.prototype._loadImage,i.isZiYu&&t&&wx.onMessage(function(n){n.isLoad&&(C.ziyuFileData[n.url]=n.data)})))},i.onMkdirCallBack=function(n,i){n||(C.filesListObj=JSON.parse(i.data))},i.pixelRatio=function(){if(!i.EnvConfig.pixelRatioInt)try{var n=wx.getSystemInfoSync();return i.EnvConfig.pixelRatioInt=n.pixelRatio,(n=n).pixelRatio}catch(n){}return i.EnvConfig.pixelRatioInt},i.createElement=function(e){var t;if("canvas"==e)return 1==i.idx?i.isZiYu?(t=sharedCanvas).style={}:t=n.canvas:t=n.wx.createCanvas(),i.idx++,t;if("textarea"==e||"input"==e)return i.onCreateInput(e);if("div"==e){var a=i._preCreateElement(e);return a.contains=function(n){return null},a.removeChild=function(n){},a}return i._preCreateElement(e)},i.onCreateInput=function(n){var e=i._preCreateElement(n);return e.focus=_.wxinputFocus,e.blur=_.wxinputblur,e.style={},e.value=0,e.parentElement={},e.placeholder={},e.type={},e.setColor=function(n){},e.setType=function(n){},e.setFontFace=function(n){},e.addEventListener=function(n){},e.contains=function(n){return null},e.removeChild=function(n){},e},i.createShaderCondition=function(n){var i=this;return function(){return i[n.replace("this.","")]}},i.EnvConfig=null,i.window=null,i._preCreateElement=null,i._inited=!1,i.wxRequest=null,i.systemInfo=null,i.version="0.0.1",i.isZiYu=!1,i.isPosMsgYu=!1,i.parseXMLFromString=function(i){var e;i=i.replace(/>\s+</g,"><");try{e=(new n.Parser.DOMParser).parseFromString(i,"text/xml")}catch(n){throw"需要引入xml解析库文件"}return e},i.idx=1,i}(),w=function(){function n(){}return a(n,"laya.wx.mini.MiniImage"),n.prototype._loadImage=function(i){var e=!1;-1==i.indexOf("layaNativeDir/")&&(e=!0,i=m.formatURL(i)),C.getFileInfo(i)?n.onCreateImage(i,this,!e):-1!=i.indexOf("http://")||-1!=i.indexOf("https://")?C.downImg(i,new s(n,n.onDownImgCallBack,[i,this]),i):n.onCreateImage(i,this,!0)},n.onDownImgCallBack=function(i,e,t){t?e.onError(null):n.onCreateImage(i,e)},n.onCreateImage=function(n,i,e){var t,a;if(void 0===e&&(e=!1),e)t=n;else{var o=C.getFileInfo(n).md5;t=C.getFileNativePath(o)}function l(){a.onload=null,a.onerror=null,delete i.imgCache[n]}null==i.imgCache&&(i.imgCache={});var s=function(){l(),i.onLoaded(a)},d=function(){l(),i.event("error","Load image failed")};"nativeimage"==i._type?((a=new r.window.Image).crossOrigin="",a.onload=s,a.onerror=d,a.src=t,i.imgCache[n]=a):new u.create(t,{onload:s,onerror:d,onCreate:function(e){a=e,i.imgCache[n]=e}})},n}(),_=function(){function i(){}return a(i,"laya.wx.mini.MiniInput"),i._createInputElement=function(){d._initInput(d.area=r.createElement("textarea")),d._initInput(d.input=r.createElement("input")),d.inputContainer=r.createElement("div"),d.inputContainer.style.position="absolute",d.inputContainer.style.zIndex=1e5,r.container.appendChild(d.inputContainer),d.inputContainer.setPos=function(n,i){d.inputContainer.style.left=n+"px",d.inputContainer.style.top=i+"px"},e.stage.on("resize",null,i._onStageResize),wx.onWindowResize&&wx.onWindowResize(function(i){n.dispatchEvent&&n.dispatchEvent("resize")}),v._soundClass=F,v._musicClass=F},i._onStageResize=function(){e.stage._canvasTransform.identity().scale(r.width/f.canvas.width/p.getPixelRatio(),r.height/f.canvas.height/p.getPixelRatio())},i.wxinputFocus=function(n){var i=d.inputElement.target;i&&!i.editable||(y.window.wx.offKeyboardConfirm(),y.window.wx.offKeyboardInput(),y.window.wx.showKeyboard({defaultValue:i.text,maxLength:i.maxChars,multiple:i.multiline,confirmHold:!0,confirmType:"done",success:function(n){},fail:function(n){}}),y.window.wx.onKeyboardConfirm(function(n){var e=n?n.value:"";i.text=e,i.event("input"),laya.wx.mini.MiniInput.inputEnter()}),y.window.wx.onKeyboardInput(function(n){var e=n?n.value:"";i.multiline||-1==e.indexOf("\n")?(i.text=e,i.event("input")):laya.wx.mini.MiniInput.inputEnter()}))},i.inputEnter=function(){d.inputElement.target.focus=!1},i.wxinputblur=function(){i.hideKeyboard()},i.hideKeyboard=function(){y.window.wx.offKeyboardConfirm(),y.window.wx.offKeyboardInput(),y.window.wx.hideKeyboard({success:function(n){console.log("隐藏键盘")},fail:function(n){console.log("隐藏键盘出错:"+(n?n.errMsg:""))}})},i}(),x=function(){function n(){}a(n,"laya.wx.mini.MiniLoader");var i=n.prototype;return i.load=function(i,e,t,a,o){void 0===t&&(t=!0),void 0===o&&(o=!1);var r=this;r._url=i,0===i.indexOf("data:image")?r._type=e="image":r._type=e||(e=r.getTypeFromUrl(i)),r._cache=t,r._data=null;var l="ascii";-1!=i.indexOf(".fnt")?l="utf8":"arraybuffer"==e&&(l="");var u=g.getFileExtension(i);if(-1!=n._fileTypeArr.indexOf(u))y.EnvConfig.load.call(this,i,e,t,a,o);else if(C.getFileInfo(i))y.EnvConfig.load.call(this,i,e,t,a,o);else{if(-1!=i.indexOf("layaNativeDir/")){if(y.isZiYu){var d=C.ziyuFileData[i];return void r.onLoaded(d)}return void C.read(i,l,new s(n,n.onReadNativeCallBack,[l,i,e,t,a,o,r]))}if(""==m.rootPath)var c=i;else c=i.split(m.rootPath)[0];-1!=i.indexOf("http://")||-1!=i.indexOf("https://")?y.EnvConfig.load.call(r,i,e,t,a,o):C.readFile(c,l,new s(n,n.onReadNativeCallBack,[l,i,e,t,a,o,r]),i)}},i.clearRes=function(n,i){void 0===i&&(i=!1);this.clearRes(n,i);var e=C.getFileInfo(n);if(e&&(-1!=n.indexOf("http://")||-1!=n.indexOf("https://"))){var t=e.md5,a=C.getFileNativePath(t);C.remove(a)}},n.onReadNativeCallBack=function(n,i,e,t,a,o,r,l,u){var s;(void 0===t&&(t=!0),void 0===o&&(o=!1),void 0===l&&(l=0),l)?1==l&&y.EnvConfig.load.call(r,i,e,t,a,o):(s="json"==e||"atlas"==e?y.getJson(u.data):"xml"==e?g.parseXMLFromString(u.data):u.data,r.onLoaded(s),!y.isZiYu&&y.isPosMsgYu&&"arraybuffer"!=e&&wx.postMessage({url:i,data:s,isLoad:!0}))},t(n,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]),n}(),C=function(n){function i(){i.__super.call(this)}return a(i,"laya.wx.mini.MiniFileMgr",l),i.isLoadFile=function(n){return-1!=i._fileTypeArr.indexOf(n)},i.getFileInfo=function(n){var e=n.split("?")[0],t=i.filesListObj[e];return null==t?null:t},i.onFileUpdate=function(n,e){var t=n.split("/"),a=t[t.length-1],o=i.getFileInfo(e);null==o?i.onSaveFile(e,a):o.readyUrl!=e&&i.remove(a,e)},i.exits=function(n,e){var t=i.getFileNativePath(n);i.fs.getFileInfo({filePath:t,success:function(n){null!=e&&e.runWith([0,n])},fail:function(n){null!=e&&e.runWith([1,n])}})},i.read=function(n,e,t,a){var o;void 0===e&&(e="ascill"),void 0===a&&(a=""),o=""!=a?i.getFileNativePath(n):n,i.fs.readFile({filePath:o,encoding:e,success:function(n){null!=t&&t.runWith([0,n])},fail:function(n){n&&""!=a?i.down(a,e,t,a):null!=t&&t.runWith([1])}})},i.readNativeFile=function(n,e){i.fs.readFile({filePath:n,encoding:"",success:function(n){null!=e&&e.runWith([0])},fail:function(n){null!=e&&e.runWith([1])}})},i.down=function(n,e,t,a){void 0===e&&(e="ascill"),void 0===a&&(a="");var o=i.getFileNativePath(a);i.wxdown({url:n,filePath:o,success:function(n){200===n.statusCode&&i.readFile(n.filePath,e,t,a)},fail:function(n){null!=t&&t.runWith([1,n])}}).onProgressUpdate(function(n){null!=t&&t.runWith([2,n.progress])})},i.readFile=function(n,e,t,a){void 0===e&&(e="ascill"),void 0===a&&(a=""),i.fs.readFile({filePath:n,encoding:e,success:function(e){-1==n.indexOf("http://")&&-1==n.indexOf("https://")||i.onFileUpdate(n,a),null!=t&&t.runWith([0,e])},fail:function(n){n&&null!=t&&t.runWith([1,n])}})},i.downImg=function(n,e,t){void 0===t&&(t="");i.wxdown({url:n,success:function(n){200===n.statusCode&&i.copyFile(n.tempFilePath,t,e)},fail:function(n){null!=e&&e.runWith([1,n])}})},i.copyFile=function(n,e,t){var a=n.split("/"),o=a[a.length-1],r=(e.split("?")[0],i.getFileInfo(e)),l=i.getFileNativePath(o);i.fs.copyFile({srcPath:n,destPath:l,success:function(n){r?r.readyUrl!=e&&i.remove(o,e,t):(i.onSaveFile(e,o),null!=t&&t.runWith([0]))},fail:function(n){null!=t&&t.runWith([1,n])}})},i.getFileNativePath=function(n){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+n},i.remove=function(n,t,a){void 0===t&&(t="");var o=i.getFileInfo(t),r=i.getFileNativePath(o.md5);e.loader.clearRes(o.readyUrl),i.fs.unlink({filePath:r,success:function(e){""!=t&&i.onSaveFile(t,n),null!=a&&a.runWith([0])},fail:function(n){}})},i.onSaveFile=function(n,e){var t=n.split("?")[0];i.filesListObj[t]={md5:e,readyUrl:n},i.fs.writeFile({filePath:i.fileNativeDir+"/"+i.fileListName,encoding:"utf8",data:JSON.stringify(i.filesListObj),success:function(n){},fail:function(n){}})},i.existDir=function(n,e){i.fs.mkdir({dirPath:n,success:function(n){null!=e&&e.runWith([0,{data:JSON.stringify({})}])},fail:function(n){-1!=n.errMsg.indexOf("file already exists")?i.readSync(i.fileListName,"utf8",e):null!=e&&e.runWith([1,n])}})},i.readSync=function(n,e,t,a){void 0===e&&(e="ascill"),void 0===a&&(a="");var o,r=i.getFileNativePath(n);try{o=i.fs.readFileSync(r,e),null!=t&&t.runWith([0,{data:o}])}catch(n){null!=t&&t.runWith([1])}},i.setNativeFileDir=function(n){i.fileNativeDir=wx.env.USER_DATA_PATH+n},i.filesListObj={},i.fileNativeDir=null,i.fileListName="layaairfiles.txt",i.ziyuFileData={},t(i,["_fileTypeArr",function(){return this._fileTypeArr=["json","ani","xml","sk","txt","atlas","swf","part","fnt","proto","lh","lav","lani","lmat","lm","ltc"]},"fs",function(){return this.fs=wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=wx.downloadFile}]),i}(),F=function(n){function i(){this._sound=null,this.url=null,this.loaded=!1,i.__super.call(this),this._sound=i._createSound()}a(i,"laya.wx.mini.MiniSound",l);var e=i.prototype;return e.load=function(n){var e=this;if(n=m.formatURL(n),this.url=n,i._audioCache[n])this.event("complete");else{this._sound.src=n,this._sound.onCanplay(function(){a(),t.loaded=!0,t.event("complete"),i._audioCache[t.url]=t});var t=this;this._sound.onError(function(){a(),t.event("error")})}function a(){e._sound.onCanplay(null),e._sound.onError(null)}},e.play=function(n,e){var t;void 0===n&&(n=0),void 0===e&&(e=0),this.url==v._tMusic?(i._musicAudio||(i._musicAudio=i._createSound()),t=i._musicAudio):t=i._createSound(),t.src=this.url;var a=new E(t);return a.url=this.url,a.loops=e,a.startTime=n,a.play(),v.addChannel(a),a},e.dispose=function(){var n=i._audioCache[this.url];n&&(n.src="",delete i._audioCache[this.url])},o(0,e,"duration",function(){return this._sound.duration}),i._createSound=function(){return i._id++,y.window.wx.createInnerAudioContext()},i._musicAudio=null,i._id=0,i._audioCache={},i}(),E=function(n){function i(n){this._audio=null,this._onEnd=null,i.__super.call(this),this._audio=n,this._onEnd=g.bind(this.__onEnd,this),n.onEnded(this._onEnd)}a(i,"laya.wx.mini.MiniSoundChannel",h);var t=i.prototype;return t.__onEnd=function(){if(1==this.loops)return this.completeHandler&&(e.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");this.loops>0&&this.loops--,this.startTime=0,this.play()},t.play=function(){this.isStopped=!1,v.addChannel(this),this._audio.play()},t.stop=function(){this.isStopped=!0,v.removeChannel(this),this.completeHandler=null,this._audio&&(this._audio.stop(),this._audio.onEnded(null),this._audio=null)},t.pause=function(){this.isStopped=!0,this._audio.pause()},t.resume=function(){this._audio&&(this.isStopped=!1,v.addChannel(this),this._audio.play())},o(0,t,"position",function(){return this._audio?this._audio.currentTime:0}),o(0,t,"duration",function(){return this._audio?this._audio.duration:0}),o(0,t,"volume",function(){return 1},function(n){}),i}()}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(n,i){"use strict";for(var e in Object.defineProperty(i,"__esModule",{value:!0}),Laya){var t=Laya[e];t&&t.__isclass&&(i[e]=t)}});