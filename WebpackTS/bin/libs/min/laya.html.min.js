!function(window,document,Laya){var __un=Laya.un,__uns=Laya.uns,__static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec,Browser=laya.utils.Browser,CSSStyle=laya.display.css.CSSStyle,ClassUtils=laya.utils.ClassUtils,Event=laya.events.Event,HTMLChar=laya.utils.HTMLChar,Loader=laya.net.Loader,Node=laya.display.Node,Rectangle=laya.maths.Rectangle,Render=laya.renders.Render,RenderContext=laya.renders.RenderContext,RenderSprite=laya.renders.RenderSprite,Sprite=laya.display.Sprite,Stat=laya.utils.Stat,Text=laya.display.Text,Texture=laya.resource.Texture,URL=laya.net.URL,Utils=laya.utils.Utils,HTMLParse=function(){function t(){}return __class(t,"laya.html.utils.HTMLParse"),t.parse=function(e,i,n){i=(i="<root>"+(i=i.replace(/<br>/g,"<br/>"))+"</root>").replace(t.spacePattern,t.char255);var s=Utils.parseXMLFromString(i);t._parseXML(e,s.childNodes[0].childNodes,n)},t._parseXML=function(e,i,n,s){var r=0,l=0;if(i.join||i.item)for(r=0,l=i.length;r<l;++r)t._parseXML(e,i[r],n,s);else{var a,h,o;if(3==i.nodeType)return void(e instanceof laya.html.dom.HTMLDivElement?(null==i.nodeName&&(i.nodeName="#text"),h=i.nodeName.toLowerCase(),(o=i.textContent.replace(/^\s+|\s+$/g,"")).length>0&&(a=ClassUtils.getInstance(h))&&(e.addChild(a),a.innerTEXT=o.replace(t.char255AndOneSpacePattern," "))):(o=i.textContent.replace(/^\s+|\s+$/g,"")).length>0&&(e.innerTEXT=o.replace(t.char255AndOneSpacePattern," ")));if("#comment"==(h=i.nodeName.toLowerCase()))return;if(a=ClassUtils.getInstance(h)){(a=e.addChild(a)).URI=n,a.href=s;var _=i.attributes;if(_&&_.length>0)for(r=0,l=_.length;r<l;++r){var u=_[r],d=u.nodeName,c=u.value;a._setAttributes(d,c)}t._parseXML(a,i.childNodes,n,a.href)}else t._parseXML(e,i.childNodes,n,s)}},__static(t,["char255",function(){return this.char255=String.fromCharCode(255)},"spacePattern",function(){return this.spacePattern=/&nbsp;|&#160;/g},"char255AndOneSpacePattern",function(){return this.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g")}]),t}(),Layout=function(){function t(){}return __class(t,"laya.html.utils.Layout"),t.later=function(e){null==t._will&&(t._will=[],Laya.stage.frameLoop(1,null,function(){if(!(t._will.length<1)){for(var e=0;e<t._will.length;e++)laya.html.utils.Layout.layout(t._will[e]);t._will.length=0}})),t._will.push(e)},t.layout=function(e){if(!e||!e._style)return null;if(0==(512&e._style._type))return null;e.getStyle()._type&=-513;var i=t._multiLineLayout(e);return Render.isConchApp&&e.layaoutCallNative&&e.layaoutCallNative(),i},t._multiLineLayout=function(e){if(Text.RightToLeft)return t._multiLineLayout2(e);var i=new Array;e._addChildsToLayout(i);var n,s,r,l,a,h=0,o=i.length,_=e._getCSSStyle(),u=_.letterSpacing,d=_.leading,c=_.lineHeight,f=_._widthAuto()||!_.wordWrap,y=f?999999:e.width,g=(e.height,0),p=_.italic?_.fontSize/3:0,m=_._getAlign(),L=_._getValign(),w=0!==L||0!==m||0!=c,x=0,v=0,T=0,S=0,M=new Array,E=M[0]=new LayoutLine,H=!1,C=!1;E.h=0,_.italic&&(y-=_.fontSize/3);var R=0,I=!0;function A(){E.y=v,v+=E.h+d,0==E.h&&(v+=c),E.mWidth=R,R=0,E=new LayoutLine,M.push(E),E.h=0,x=0,I=!0,H=!1}for(h=0;h<o;h++)if(null!=(n=i[h]))if(I=!1,n instanceof laya.html.dom.HTMLBrElement)A(),E.y=v;else{if(n._isChar()){if((l=n).isWord)H=C||"\n"===l.char,E.wordStartIndex=E.elements.length;else{if(M.length>0&&x+T>y&&E.wordStartIndex>0){var N;N=E.elements.length-E.wordStartIndex+1,E.elements.length=E.wordStartIndex,h-=N,A();continue}H=!1,R+=l.width}T=l.width+u,S=l.height,C=!1,(H=H||x+T>y)&&A(),E.minTextHeight=Math.min(E.minTextHeight,n.height)}else a=n,r=(s=n._getCSSStyle()).padding,0===s._getCssFloat()||(w=!0),H=C||s.lineElement,T=a.width*a._style._tf.scaleX+r[1]+r[3]+u,S=a.height*a._style._tf.scaleY+r[0]+r[2],C=s.lineElement,(H=H||x+T>y&&s.wordWrap)&&A();E.elements.push(n),E.h=Math.max(E.h,S),n.x=x,n.y=v,x+=T,E.w=x-u,E.y=v,g=Math.max(x+p,g)}else I||(x+=t.DIV_ELEMENT_PADDING),E.wordStartIndex=E.elements.length;if(v=E.y+E.h,w){var U=0,P=y;for(f&&e.width>0&&(P=e.width),h=0,o=M.length;h<o;h++)M[h].updatePos(0,P,h,U,m,L,c),U+=Math.max(c,M[h].h+d);v=U}return f&&(e.width=g),v>e.height&&(e.height=v),[g,v]},t._multiLineLayout2=function(e){var i=new Array;e._addChildsToLayout(i);var n,s,r,l,a,h=0,o=i.length,_=e._getCSSStyle(),u=_.letterSpacing,d=_.leading,c=_.lineHeight,f=_._widthAuto()||!_.wordWrap,y=f?999999:e.width,g=(e.height,0),p=_.italic?_.fontSize/3:0,m=2-_._getAlign(),L=_._getValign(),w=0!==L||0!==m||0!=c,x=0,v=0,T=0,S=0,M=new Array,E=M[0]=new LayoutLine,H=!1,C=!1;E.h=0,_.italic&&(y-=_.fontSize/3);var R=0,I=!0;function A(){E.y=v,v+=E.h+d,0==E.h&&(v+=c),E.mWidth=R,R=0,E=new LayoutLine,M.push(E),E.h=0,x=0,I=!0,H=!1}for(h=0;h<o;h++)if(null!=(n=i[h]))if(I=!1,n instanceof laya.html.dom.HTMLBrElement)A(),E.y=v;else{if(n._isChar()){if((l=n).isWord)H=C||"\n"===l.char,E.wordStartIndex=E.elements.length;else{if(M.length>0&&x+T>y&&E.wordStartIndex>0){var N;N=E.elements.length-E.wordStartIndex+1,E.elements.length=E.wordStartIndex,h-=N,A();continue}H=!1,R+=l.width}T=l.width+u,S=l.height,C=!1,(H=H||x+T>y)&&A(),E.minTextHeight=Math.min(E.minTextHeight,n.height)}else a=n,r=(s=n._getCSSStyle()).padding,0===s._getCssFloat()||(w=!0),H=C||s.lineElement,T=a.width*a._style._tf.scaleX+r[1]+r[3]+u,S=a.height*a._style._tf.scaleY+r[0]+r[2],C=s.lineElement,(H=H||x+T>y&&s.wordWrap)&&A();E.elements.push(n),E.h=Math.max(E.h,S),n.x=x,n.y=v,x+=T,E.w=x-u,E.y=v,g=Math.max(x+p,g)}else I||(x+=t.DIV_ELEMENT_PADDING),E.wordStartIndex=E.elements.length;if(v=E.y+E.h,w){var U=0,P=y;for(h=0,o=M.length;h<o;h++)M[h].updatePos(0,P,h,U,m,L,c),U+=Math.max(c,M[h].h+d);v=U}for(f&&(e.width=g),v>e.height&&(e.height=v),h=0,o=M.length;h<o;h++)M[h].revertOrder(y);return[g,v]},t._will=null,t.DIV_ELEMENT_PADDING=0,t}(),LayoutLine=function(){function t(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array}__class(t,"laya.html.utils.LayoutLine");var e=t.prototype;return e.updatePos=function(t,e,i,n,s,r,l){var a,h=0;this.elements.length>0&&(h=(a=this.elements[this.elements.length-1]).x+a.width-this.elements[0].x);var o=0,_=NaN;1===s&&(o=(e-h)/2),2===s&&(o=e-h),0===l||0!=r||(r=1);for(var u=0,d=this.elements.length;u<d;u++){var c=(a=this.elements[u])._getCSSStyle();switch(0!==o&&(a.x+=o),c._getValign()){case 0:a.y=n;break;case 1:var f=0;99999!=this.minTextHeight&&(f=this.minTextHeight);var y=(f+l)/2;y=Math.max(y,this.h),_=(laya.html.dom.HTMLImageElement,n+y-a.height),a.y=_;break;case 2:a.y=n+(l-a.height)}}},e.revertOrder=function(t){var e;if(this.elements.length>0){var i,n=0;for(i=this.elements.length,n=0;n<i;n++)(e=this.elements[n]).x=t-e.x-e.width}},t}(),HTMLElement=function(_super){function HTMLElement(){this.URI=null,this._href=null,HTMLElement.__super.call(this),this._text=HTMLElement._EMPTYTEXT,this.setStyle(new CSSStyle(this)),this._getCSSStyle().valign="middle",this.mouseEnabled=!0}__class(HTMLElement,"laya.html.dom.HTMLElement",_super);var __proto=HTMLElement.prototype;return __proto.layaoutCallNative=function(){var t=0;if(this._childs&&(t=this._childs.length)>0)for(var e=0;e<t;e++)this._childs[e].layaoutCallNative&&this._childs[e].layaoutCallNative();var i=this._getWords();i?laya.html.dom.HTMLElement.fillWords(this,i,0,0,this.style.font,this.style.color,this.style.underLine):this.graphics.clear()},__proto.appendChild=function(t){return this.addChild(t)},__proto._getWords2=function(){var t=this._text.text;if(!t||0===t.length)return null;var e,i,n=0,s=0;if(this._text.drawWords)i=this._text.drawWords;else{for(s=(e=t.split(" ")).length-1,i=[],n=0;n<s;n++)i.push(e[n]," ");s>=0&&i.push(e[s]),this._text.drawWords=i}var r,l=this._text.words;if(l&&l.length===i.length)return l;null===l&&(this._text.words=l=[]),l.length=i.length;var a=this.style,h=a.font;for(n=0,s=i.length;n<s;n++){r=Utils.measureText(i[n],h);var o=l[n]=new HTMLChar(i[n],r.width,r.height||a.fontSize,a);if(o.char.length>1&&(o.charNum=o.char),this.href){var _=new Sprite;this.addChild(_),o.setSprite(_)}}return l},__proto._getWords=function(){if(!Text.CharacterCache)return this._getWords2();var t=this._text.text;if(!t||0===t.length)return null;var e,i=this._text.words;if(i&&i.length===t.length)return i;null===i&&(this._text.words=i=[]),i.length=t.length;for(var n=this.style,s=n.font,r=0,l=t.length;r<l;r++){e=Utils.measureText(t.charAt(r),s);var a=i[r]=new HTMLChar(t.charAt(r),e.width,e.height||n.fontSize,n);if(this.href){var h=new Sprite;this.addChild(h),a.setSprite(h)}}return i},__proto.showLinkSprite=function(){var t=this._text.words;if(t)for(var e,i,n=[],s=0;s<t.length;s++)i=t[s],(e=new Sprite).graphics.drawRect(0,0,i.width,i.height,"#ff0000"),e.width=i.width,e.height=i.height,this.addChild(e),n.push(e)},__proto._layoutLater=function(){var t=this.style;512&t._type||(t.widthed(this)&&(this._childs.length>0||null!=this._getWords())&&t.block?(Layout.later(this),t._type|=512):this.parent&&this.parent._layoutLater())},__proto._setAttributes=function(t,e){switch(t){case"style":return void this.style.cssText(e);case"class":return void(this.className=e)}_super.prototype._setAttributes.call(this,t,e)},__proto.updateHref=function(){if(null!=this._href){var t=this._getWords();if(t)for(var e,i,n=0;n<t.length;n++)(i=(e=t[n]).getSprite())&&(i.size(e.width,e.height),i.on("click",this,this.onLinkHandler))}},__proto.onLinkHandler=function(t){switch(t.type){case"click":for(var e=this;e;)e.event("link",[this.href]),e=e.parent}},__proto.formatURL=function(t){return this.URI?URL.formatURL(t,this.URI?this.URI.path:null):t},__getset(0,__proto,"href",function(){return this._href},function(t){this._href=t,null!=t&&(this._getCSSStyle().underLine=1,this.updateHref())}),__getset(0,__proto,"color",null,function(t){this.style.color=t}),__getset(0,__proto,"onClick",null,function(value){var fn;eval("fn=function(event){"+value+";}"),this.on("click",this,fn)}),__getset(0,__proto,"id",null,function(t){HTMLDocument.document.setElementById(t,this)}),__getset(0,__proto,"innerTEXT",function(){return this._text.text},function(t){this.text=t}),__getset(0,__proto,"style",function(){return this._style}),__getset(0,__proto,"text",function(){return this._text.text},function(t){this._text==HTMLElement._EMPTYTEXT?this._text={text:t,words:null}:(this._text.text=t,this._text.words&&(this._text.words.length=0)),Render.isConchApp&&this.layaoutCallNative(),this._renderType|=2048,this.repaint(),this.updateHref()}),__getset(0,__proto,"parent",_super.prototype._$get_parent,function(t){if(t instanceof laya.html.dom.HTMLElement){var e=t;this.URI||(this.URI=e.URI),this.style.inherit(e.style)}Laya.superSet(Sprite,this,"parent",t)}),__getset(0,__proto,"className",null,function(t){this.style.attrs(HTMLDocument.document.styleSheets["."+t])}),HTMLElement.fillWords=function(t,e,i,n,s,r,l){t.graphics.clear();for(var a=0,h=e.length;a<h;a++){var o=e[a];t.graphics.fillText(o.char,o.x+i,o.y+n,s,r,"left",l)}},__static(HTMLElement,["_EMPTYTEXT",function(){return this._EMPTYTEXT={text:null,words:null}}]),HTMLElement}(Sprite),HTMLBrElement=function(t){function e(){e.__super.call(this),this.style.lineElement=!0,this.style.block=!0}return __class(e,"laya.html.dom.HTMLBrElement",HTMLElement),e}(),HTMLDivElement=function(t){function e(){this.contextHeight=NaN,this.contextWidth=NaN,e.__super.call(this),this.style.block=!0,this.style.lineElement=!0,this.style.width=200,this.style.height=200}__class(e,"laya.html.dom.HTMLDivElement",t);var i=e.prototype;return i.appendHTML=function(t){HTMLParse.parse(this,t,this.URI),this.layout()},i._addChildsToLayout=function(t){var e=this._getWords();if(null==e&&0==this._childs.length)return!1;e&&e.forEach(function(e){t.push(e)});for(var i=!0,n=0,s=this._childs.length;n<s;n++){var r=this._childs[n];i?i=!1:t.push(null),r._addToLayout(t)}return!0},i._addToLayout=function(t){this.layout()},i.layout=function(){if(this.style){this.style._type|=512;var t=Layout.layout(this);if(t){this._$P.mHtmlBounds||this._set$P("mHtmlBounds",new Rectangle);var e=this._$P.mHtmlBounds;e.x=e.y=0,e.width=this.contextWidth=t[0],e.height=this.contextHeight=t[1],this.setBounds(e)}}},__getset(0,i,"height",function(){return this._height?this._height:this.contextHeight},t.prototype._$set_height),__getset(0,i,"innerHTML",null,function(t){this.destroyChildren(),this.appendHTML(t)}),__getset(0,i,"width",function(){return this._width?this._width:this.contextWidth},function(t){var e=!1;e=0===t?t!=this._width:t!=this.width,Laya.superSet(HTMLElement,this,"width",t),e&&this.layout()}),e}(HTMLElement),HTMLDocument=function(t){function e(){this.all=new Array,this.styleSheets=CSSStyle.styleSheets,e.__super.call(this)}__class(e,"laya.html.dom.HTMLDocument",HTMLElement);var i=e.prototype;return i.getElementById=function(t){return this.all[t]},i.setElementById=function(t,e){this.all[t]=e},__static(e,["document",function(){return this.document=new e}]),e}(),HTMLImageElement=function(t){function e(){this._tex=null,this._url=null,this._renderArgs=[],e.__super.call(this),this.style.block=!0}__class(e,"laya.html.dom.HTMLImageElement",HTMLElement);var i=e.prototype;return i._addToLayout=function(t){!this._style.absolute&&t.push(this)},i.render=function(t,e,i){!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1||(Stat.spriteCount++,this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,t.ctx.drawTexture2(e,i,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs))},i.layaoutCallNative=function(){var t=0;if(this._childs&&(t=this._childs.length)>0)for(var e=0;e<t;e++)this._childs[e].layaoutCallNative&&this._childs[e].layaoutCallNative()},__getset(0,i,"src",null,function(t){var e=this;if(t=this.formatURL(t),this._url!=t){this._url=t;var i=this._tex=Loader.getRes(t);i||(this._tex=i=new Texture,i.load(t),Loader.cacheRes(t,i)),i.loaded?n():i.on("loaded",null,n)}function n(){var t=e._style;t.widthed(e)||e._tex.width,t.heighted(e)||e._tex.height;t.widthed(e)||e._width==e._tex.width||(e.width=e._tex.width,e.parent&&e.parent._layoutLater()),t.heighted(e)||e._height==e._tex.height||(e.height=e._tex.height,e.parent&&e.parent._layoutLater()),Render.isConchApp&&(e._renderArgs[0]=e._tex,e._renderArgs[1]=e.x,e._renderArgs[2]=e.y,e._renderArgs[3]=e.width||e._tex.width,e._renderArgs[4]=e.height||e._tex.height,e.graphics.drawTexture(e._tex,0,0,e._renderArgs[3],e._renderArgs[4])),e.repaint(),e.parentRepaint()}}),e}(),HTMLLinkElement=function(t){function e(){this.type=null,e.__super.call(this),this.visible=!1}__class(e,"laya.html.dom.HTMLLinkElement",t);var i=e.prototype;return i._onload=function(t){switch(this.type){case"text/css":CSSStyle.parseCSS(t,this.URI)}},__getset(0,i,"href",t.prototype._$get_href,function(t){var e=this;t=this.formatURL(t),this.URI=new URL(t);var i=new Loader;i.once("complete",null,function(t){e._onload(t)}),i.load(t,"text")}),__static(e,["_cuttingStyle",function(){return this._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g")}]),e}(HTMLElement),HTMLStyleElement=function(t){function e(){e.__super.call(this),this.visible=!1}__class(e,"laya.html.dom.HTMLStyleElement",t);var i=e.prototype;return __getset(0,i,"text",t.prototype._$get_text,function(t){CSSStyle.parseCSS(t,null)}),e}(HTMLElement),HTMLIframeElement=function(t){function e(){e.__super.call(this),this._getCSSStyle().valign="middle"}__class(e,"laya.html.dom.HTMLIframeElement",t);var i=e.prototype;return __getset(0,i,"href",t.prototype._$get_href,function(t){var e=this;t=this.formatURL(t);var i=new Loader;i.once("complete",null,function(i){var n=e.URI;e.URI=new URL(t),e.innerHTML=i,!n||(e.URI=n)}),i.load(t,"text")}),e}(HTMLDivElement)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(t,e){"use strict";for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(e[i]=n)}});